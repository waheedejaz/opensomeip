@startuml Deployment Architecture

title SOME/IP Stack Deployment Architecture

node "ECU 1\n(Head Unit)" as ECU1 {
    component [Navigation App] as NavApp
    component [SOME/IP Client] as Client1
    component [SD Client] as SDClient1

    frame "SOME/IP Stack" as Stack1 {
        component [RPC Engine] as RPC1
        component [Transport\n(UDP/TCP)] as Transport1
        component [Safety Monitor] as Safety1
    }
}

node "ECU 2\n(Instrument Cluster)" as ECU2 {
    component [Display App] as DisplayApp
    component [SOME/IP Client] as Client2
    component [SD Client] as SDClient2

    frame "SOME/IP Stack" as Stack2 {
        component [RPC Engine] as RPC2
        component [Transport\n(UDP/TCP)] as Transport2
        component [Safety Monitor] as Safety2
    }
}

node "ECU 3\n(Central Gateway)" as ECU3 {
    component [Gateway Service] as GatewaySvc
    component [SOME/IP Server] as Server1
    component [SD Server] as SDServer1

    frame "SOME/IP Stack" as Stack3 {
        component [RPC Engine] as RPC3
        component [Transport\n(UDP/TCP)] as Transport3
        component [Safety Monitor] as Safety3
        component [Service Discovery] as SD3
    }
}

node "ECU 4\n(Powertrain)" as ECU4 {
    component [Engine Control] as EngineCtrl
    component [SOME/IP Server] as Server2
    component [SD Server] as SDServer2

    frame "SOME/IP Stack" as Stack4 {
        component [RPC Engine] as RPC4
        component [Transport\n(UDP/TCP)] as Transport4
        component [Safety Monitor] as Safety4
        component [Service Discovery] as SD4
    }
}

node "Ethernet Switch" as Switch {
    component [Layer 2 Switching] as L2Switch
    component [VLAN Support] as VLAN
}

' Network Connections
ECU1 -- Switch : 100BASE-T1
ECU2 -- Switch : 100BASE-T1
ECU3 -- Switch : 1000BASE-T1
ECU4 -- Switch : 100BASE-T1

' SOME/IP Communication Paths
Client1 ..> Server1 : RPC Calls\n(Method Invocation)
Client1 ..> SDServer1 : Service Discovery\n(Find/Offer)
Client2 ..> Server1 : RPC Calls\n(Data Requests)
Client2 ..> SDServer1 : Service Discovery

Server2 ..> Client1 : Event Notifications
Server2 ..> Client2 : Event Notifications
SDServer2 ..> SDClient1 : Service Offers
SDServer2 ..> SDClient2 : Service Offers

' Multicast Communication
SDClient1 ..> Switch : Multicast\nService Discovery
SDClient2 ..> Switch : Multicast\nService Discovery
SDServer1 ..> Switch : Multicast\nService Offers
SDServer2 ..> Switch : Multicast\nService Offers

' Safety Communication
Safety1 ..> Safety2 : Safety State\nSynchronization
Safety1 ..> Safety3 : Fault Monitoring
Safety1 ..> Safety4 : Safety Monitoring
Safety2 ..> Safety3 : Safety Coordination
Safety2 ..> Safety4 : Safety Coordination
Safety3 ..> Safety4 : Safety Supervision

' Deployment Notes
note right of ECU1
    **Client ECU:**
    - Runs SOME/IP client
    - Discovers services
    - Makes RPC calls
    - Receives events
end note

note right of ECU3
    **Gateway ECU:**
    - Central service provider
    - Routes SOME/IP messages
    - Service discovery hub
    - Safety coordination
end note

note right of ECU4
    **Server ECU:**
    - Provides services
    - Publishes events
    - Offers services via SD
    - Safety-critical functions
end note

' Ethernet Configuration
note over Switch
    **Ethernet Network:**
    - 100Mbit/s - 1Gbit/s
    - VLAN segregation
    - QoS for safety messages
    - SOME/IP multicast groups:
      * 239.118.122.69:30490 (SD)
      * Service-specific groups
end note

' Safety Architecture
note as SafetyArch
    **Safety Architecture:**
    - Distributed safety monitoring
    - Fault containment zones
    - Safety state synchronization
    - ASIL-B certified components
    - Redundant communication paths
end note

SafetyArch .down.> ECU1

' Performance Characteristics
note as Performance
    **Performance Targets:**
    - RPC latency: <10ms
    - Event latency: <5ms
    - SD response: <100ms
    - Network utilization: <20%
    - CPU overhead: <5%
end note

Performance .right.> Switch

@enduml
